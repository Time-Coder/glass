#ifndef __VAO__
#define __VAO__

#include <set>
#include <map>

#include "glass/common.h"
#include "glass/VBO"
#include "glass/EBO"

struct VertexAttribPointer
{
	uint location = 0;
	uint vertex_size = 0;
	uint dtype = GL_FLOAT;
	uint should_normalize = GL_FALSE;
	uint stride = 0;
	uint offset = 0;

	VBO vbo;

	VertexAttribPointer(uint _location = 0, uint _vertex_size = 0, uint _dtype = GL_FLOAT, uint _should_normalize = GL_FALSE, uint _stride = 0, uint _offset = 0);
	VertexAttribPointer& operator ()(uint _vertex_size, uint _dtype = GL_FLOAT, uint _should_normalize = GL_FALSE, uint _stride = 0, uint _offset = 0);

	void interp(const VBO& _vbo);
	void divisor(uint n);
	void update_policy(uint n);
	bool empty()const;
};

class VAO
{
private:
	static std::multiset<uint> existing_VAOs;
	static uint active_VAO;

private:
	uint _id = 0;
	EBO _ebo;
	std::map<uint, VertexAttribPointer> map_VAP;

private:
	void init();
	void del();

public:
	VAO();
	VAO(const VAO& vao);
	VAO(VAO&& vao);
	VAO& operator =(const VAO& ebo);
	VAO& operator =(VAO&& ebo);
	VertexAttribPointer& operator [](uint i);
	~VAO();
	uint id()const;
	EBO ebo()const;
	void bind();
	void unbind()const;
	bool empty()const;
	void drawArrays(uint n, GLenum type = GL_TRIANGLES);
	void drawElements(GLenum type = GL_TRIANGLES);
	void addEBO(const EBO& _ebo);
};

#endif